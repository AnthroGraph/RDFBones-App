
<mp-sparql-download query="
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX standards-si: <http://w3id.org/rdfbones/ext/standards-si/>

SELECT DISTINCT ?ID ?mysectionlabel ?ROI ?MeasurementType ?Measurement WHERE {
              
  					  ?? rdfs:label ?ID .
  					  ?? obo:BFO_0000051 ?section.
  					  ?section obo:BFO_0000051 ?md.	
   					  ?md <http://purl.obolibrary.org/obo/IAO_0000136> ?myROIInstance .
  					  ?myROIInstance a ?ROIClass .
   					  optional {?ROIClass rdfs:label ?ROIlabel .}	
  					  bind(if(exists{?ROIClass rdfs:label ?ROIlabel},?ROIlabel,?ROIClass) as ?ROI).
 					  ?section a ?mysection.
					  ?mysection rdfs:label ?mysectionlabel .
  					  ?md a ?mdClass .
  					  ?mdClass rdfs:label ?MeasurementType.
					  optional  {
                   			    filter (exists {
        				      ?md obo:BFO_0000051 ?md1 .
        				      ?md1 <http://purl.obolibrary.org/obo/OBI_0001938> ?mdValueSpec1.
      					    })
  					    ?md obo:BFO_0000051 ?md1 .
  					    ?md1 <http://purl.obolibrary.org/obo/OBI_0001938> ?mdValueSpec1.
  					    bind(?mdValueSpec1 as ?mdValueSpec).
           				    ?mdValueSpec <http://purl.obolibrary.org/obo/OBI_0001937>|<http://purl.obolibrary.org/obo/OBI_0000999>  ?mystate.
    					    optional{?mystate rdfs:label ?statelabel .}
  					    bind(if(exists{?mystate rdfs:label ?statelabel},?statelabel,?mystate) as ?Measurement).
  					  }
					  optional {
    					    ?md <http://purl.obolibrary.org/obo/OBI_0001938> ?mdValueSpec.
    					    ?mdValueSpec <http://purl.obolibrary.org/obo/OBI_0001937>|<http://purl.obolibrary.org/obo/OBI_0000999>  ?mystate.
    					    optional{?mystate rdfs:label ?statelabel .}
  					    bind(if(exists{?mystate rdfs:label ?statelabel},?statelabel,?mystate) as ?Measurement).
  					  }
    					  filter(bound(?mystate))	
					  } ORDER BY ?ID ?mysectionlabel ?ROI ?mdClassLabel
                    "
header="text/csv" filename="[[this.label]].csv">
  <button class="btn btn-secondary"><strong>Download CSV Table for <i>[[this.label]]</i></strong></button>
</mp-sparql-download>
